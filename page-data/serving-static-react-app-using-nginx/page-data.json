{"componentChunkName":"component---src-templates-blog-post-js","path":"/serving-static-react-app-using-nginx/","result":{"data":{"site":{"siteMetadata":{"title":"Alacrity"}},"markdownRemark":{"id":"db5a7616-e3b9-52b8-bc05-1dbaae87f4a9","excerpt":"Creating a react app First, lets create a basic react app using create-react-app: If you followed the steps to run app displayed on your CLI, you should see theâ€¦","html":"<h2>Creating a react app</h2>\n<p>First, lets create a basic react app using <a href=\"https://create-react-app.dev/\">create-react-app</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=root data-host=alacrity.dev></span></span>npx create-react-app nginx-app</code></pre></div>\n<p>If you followed the steps to run app displayed on your CLI, you should see the following page or similar page based on the package version you used.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dceea9cbf276654809db45a28f9279f0/146da/first-page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABJ0AAASdAHeZh94AAACGElEQVQ4y6WT22sTQRTG949J9jp7z8xONpts9paLSU3xLioVimJFLNgnRRSvD2JFFBV8EaT/5yczjdE2m5jiw49hZr7zzTl7ziqsk6KfDxAnKULaRkg5aBQjSXMk/QJxL1tJR2jmdLNS6hXGEyTdDCzqwA8j8HYCxw2gGeQY/SSqbkE3bdheiJhG2K6GyKsRfFqBRikU06YQGDaF5TAQL5J7nYRzWksYgnkccRksl8GwmdwrmhWinhY0sgJxN9epp+KUugz+h5WG4rU/ewpdfoa6uw0MfwdolmiOD1X3oGoONMODZgZrTddn6DBEN+4jnN1EcO4q2PV7MFx+tgyl2KZoNiy42RTt2/sonn9G8eIL2LW7cLMteSc0dcb1JRs+SLsA39nH4N0PlC+/StPR4RHYlTtrs6wxpFBVG97wIuLdA+RPP2L4/idGH46QHryRZ245kxrZrLOUTC/vIntyiOrtdxTPPqF89Q3+6JKsYKNvuCjDprKrTm8MfusB0kevkew9Bt95uOj+qhFSlkclhGoGi9XJtqARCisuYffGUMXo/KU5bbqUoeVGcIJY/te2x2GYgTwjDoNlt0A8LnH89voMBeLVFu+jGJ5H3K1QjbfR6w+RJAWyYoyimiLNx8jKCUaTC9JYNf9RsjBt6P7xqrmwOgOQdAKSz2BEOZq6i6bho6F7m5V8omtWKOdRNMfpT0F4Ls/WxfwCnPhDEVMFfywAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Basic React app\"\n        title=\"Basic React app\"\n        src=\"/static/dceea9cbf276654809db45a28f9279f0/f058b/first-page.png\"\n        srcset=\"/static/dceea9cbf276654809db45a28f9279f0/c26ae/first-page.png 158w,\n/static/dceea9cbf276654809db45a28f9279f0/6bdcf/first-page.png 315w,\n/static/dceea9cbf276654809db45a28f9279f0/f058b/first-page.png 630w,\n/static/dceea9cbf276654809db45a28f9279f0/146da/first-page.png 943w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Adding routes</h2>\n<p>Install <a href=\"https://reactrouterdotcom.fly.dev/docs/en/v6\">react-router</a> using:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=root data-host=alacrity.dev></span></span><span class=\"token function\">npm</span> <span class=\"token function\">install</span> react-router-dom@6</code></pre></div>\n<p>For simplicity lets assume following is our boring <code class=\"language-text\">App.js</code>:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BrowserRouter<span class=\"token punctuation\">,</span> Link<span class=\"token punctuation\">,</span> Routes<span class=\"token punctuation\">,</span> Route <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-router-dom\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BrowserRouter</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>nav</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Root</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/route1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Route 1</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/route2<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Route 2</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>nav</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Routes</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">element</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Root</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>route1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">element</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Route 1</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>route2<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">element</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Route 2</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Routes</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">BrowserRouter</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>How it looks:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a13bf768c880a3067f70e86244d983e8/d6331/simple-routes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABEUlEQVQoz62Qy07CYBBG//dRboIWS1suTRuI4SJI4uupD9BncSfRhdFoIoop7U8oFHoMTaxsjIT6JSeTmcXkzIiy0UCvW9RNG82oU1aNBLVSRa+ZNOwWVdPGaFgYm2pavyLypTIlpYKm1ThRKhwc5snmijGZbIFM7oh8USFXOCZbKP2J6HT7tDvnDC4u6fYGmFaTXn9IfzCk2TpD31ifaqiqvhPCdV3e3yZ8TlzkTOJ5PtPpNMbzPHxfIuXuiDBc8Pww5mk0hojUEcvlgtfHD+5vX5DePB6u12uiKNoLEQQBq3BFMF/Eg02+616GN9dXOI7D3Wj0Y5fidhEEc2ZSEoarxC6V4XaTZlGycPuh/2H4BQcY3B447HJPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Simple router\"\n        title=\"Simple router\"\n        src=\"/static/a13bf768c880a3067f70e86244d983e8/f058b/simple-routes.png\"\n        srcset=\"/static/a13bf768c880a3067f70e86244d983e8/c26ae/simple-routes.png 158w,\n/static/a13bf768c880a3067f70e86244d983e8/6bdcf/simple-routes.png 315w,\n/static/a13bf768c880a3067f70e86244d983e8/f058b/simple-routes.png 630w,\n/static/a13bf768c880a3067f70e86244d983e8/d6331/simple-routes.png 702w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Serving a static react app using nginx</h2>\n<p>After getting our production build from <code class=\"language-text\">npm run build</code>, lets put the <code class=\"language-text\">build</code> output to <code class=\"language-text\">/var/www/html/</code> and hit <code class=\"language-text\">/route1/</code> or <code class=\"language-text\">/route2</code> endpoint directly from browser.</p>\n<p>Since most static file servers use file based routing we are treated with 404 response. Only <code class=\"language-text\">/</code> endpoint is able to load correctly.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0db68a87a8ea76c5bdfdf4eff05eca0/3cb0f/nginx-404.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABNUlEQVQoz52PT0/CUBDE+21AsSpWKPBoCwXDjfBx8UoJIBzwhpcWMDU0kGCAS8u/n2lRE01KopNM3r6dncmulBEGwqhSqdQwzRpqTqDc51Du1YhqXkMYJmpBO1Ho5IROvliK+lqpglaqUtDN6C/puomqCnSjQi5fRL5RKAgD3SiTyeaR5TSJZIqLS5lE8gr5Os2dko1eoZWp1xsUSw1Stw8IUURyxmPGEScRbdthMp3y1OvRbD5iWRbdbo9Wq0Wn06VttekPBtGs45y8Tlh/+iVi8Oa+Mhw+43ketm3jui4voxGDfp+Z58XZkHa7Hdvt9geDIIjE4+GA7/vs93sCP/juhwjr374wSzoej8TxfblkPp+zXq1YLBZ43oz1ZsM5T+zJofgfxG74FfpXTTq3XVzAuQs+ANiTYN/tf0gJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Issue with SPA routing\"\n        title=\"Issue with SPA routing\"\n        src=\"/static/a0db68a87a8ea76c5bdfdf4eff05eca0/f058b/nginx-404.png\"\n        srcset=\"/static/a0db68a87a8ea76c5bdfdf4eff05eca0/c26ae/nginx-404.png 158w,\n/static/a0db68a87a8ea76c5bdfdf4eff05eca0/6bdcf/nginx-404.png 315w,\n/static/a0db68a87a8ea76c5bdfdf4eff05eca0/f058b/nginx-404.png 630w,\n/static/a0db68a87a8ea76c5bdfdf4eff05eca0/3cb0f/nginx-404.png 708w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>To fix this lets add following nginx config to <code class=\"language-text\">/etc/nginx/sites-available/default</code> and then restart nginx.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token comment\"># default</span>\n<span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">80</span></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token directive\"><span class=\"token keyword\">root</span> /var/www/html</span><span class=\"token punctuation\">;</span>\n  <span class=\"token directive\"><span class=\"token keyword\">index</span> index.html index.htm index.nginx-debian.html</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\"># To make sure any assets can get through</span>\n  <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> @rewrites</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\"># If no asset matches, send it to your javascript app.</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token comment\"># Hopefully it's a route in the app!</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token directive\"><span class=\"token keyword\">location</span> @rewrites</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token directive\"><span class=\"token keyword\">rewrite</span> ^(.+)$ /index.html last</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now we are able to navigate rotues successfully. Cheers!</p>","frontmatter":{"title":"Serve static React app using NGINX","date":"January 08, 2022","description":"A simple nginx configuration demo for serving static single page web applications with multiple routes","previewImage":null}},"previous":{"fields":{"slug":"/hello-world/"},"frontmatter":{"title":"Hello World"}},"next":{"fields":{"slug":"/yarn-audit-at-scale-with-splunk/"},"frontmatter":{"title":"Yarn Audit at Scale using Splunk"}}},"pageContext":{"id":"db5a7616-e3b9-52b8-bc05-1dbaae87f4a9","previousPostId":"0361a05e-f89a-5403-80b9-43b446e15938","nextPostId":"22dc804e-2ffc-586d-a402-96e000411112"}},"staticQueryHashes":["3134424800","3257411868"]}